<!-- Modal -->


<div class="modal fade" id="updatePatientModal" tabindex="-1" role="dialog" aria-labelledby="updatePatientModal"
    aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content ">
            <div class="modal-header">
                <h5 class="modal-title" id="updatePatientModal">Patients Updates Form</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form id="patientForm" class="needs-validation" novalidate action="/patients/update/<%= patient._id %>"
                method="post" enctype="multipart/form-data">
                <div class="modal-body">
                    <div class="card-body">
                        <!-- Basic Information -->
                        <div class="mb-4">
                            <h5 class="border-bottom pb-2 mb-3">Basic Information</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="firstName" class="form-label">First Name</label>
                                    <input type="text" class="form-control" id="firstName" name="firstName" required>
                                    <div class="invalid-feedback">Please enter first name.</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="lastName" class="form-label">Last Name</label>
                                    <input type="text" class="form-control" id="lastName" name="lastName" required>
                                    <div class="invalid-feedback">Please enter last name.</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="dateOfBirth" class="form-label">Date of Birth</label>
                                    <input type="date" class="form-control" id="dateOfBirth" name="dateOfBirth"
                                        required>
                                    <div class="invalid-feedback">Please enter date of birth.</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="gender" class="form-label">Gender</label>
                                    <select class="form-control" id="gender" name="gender" required>
                                        <option value="">Choose...</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                        <option value="other">Other</option>
                                    </select>
                                    <div class="invalid-feedback">Please select gender.</div>
                                </div>
                            </div>
                        </div>

                        <!-- Contact Information -->
                        <div class="mb-4">
                            <h5 class="border-bottom pb-2 mb-3">Contact Information</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="phone" class="form-label">Phone Number</label>
                                    <input type="tel" class="form-control" id="phone" name="phone" required>
                                    <div class="invalid-feedback">Please enter phone number.</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="email" class="form-label">Email (Optional)</label>
                                    <input type="email" class="form-control" id="email" name="email">
                                </div>
                            </div>
                        </div>

                        <!-- Emergency Contact -->
                        <div class="mb-4">
                            <h5 class="border-bottom pb-2 mb-3">Emergency Contact</h5>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="emergencyContactName" class="form-label">Contact Name</label>
                                    <input type="text" class="form-control" id="emergencyContactName"
                                        name="emergencyContactName" required>
                                    <div class="invalid-feedback">Please enter emergency contact name.</div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="emergencyContactRelationship" class="form-label">Relationship</label>
                                    <input type="text" class="form-control" id="emergencyContactRelationship"
                                        name="emergencyContactRelationship" required>
                                    <div class="invalid-feedback">Please specify relationship.</div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="emergencyContactPhone" class="form-label">Contact Phone</label>
                                    <input type="tel" class="form-control" id="emergencyContactPhone"
                                        name="emergencyContactPhone" required>
                                    <div class="invalid-feedback">Please enter emergency contact phone.</div>
                                </div>
                            </div>
                        </div>

                        <!-- Address -->
                        <div class="mb-4">
                            <h5 class="border-bottom pb-2 mb-3">Address</h5>
                            <div class="row">
                                <div class="col-12 mb-3">
                                    <label for="street" class="form-label">Street Address</label>
                                    <input type="text" class="form-control" id="street" name="street" required>
                                    <div class="invalid-feedback">Please enter street address.</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="city" class="form-label">City</label>
                                    <input type="text" class="form-control" id="city" name="city" required>
                                    <div class="invalid-feedback">Please enter city.</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="state" class="form-label">State</label>
                                    <input type="text" class="form-control" id="state" name="state" required>
                                    <div class="invalid-feedback">Please enter state.</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="zipCode" class="form-label">ZIP Code</label>
                                    <input type="text" class="form-control" id="zipCode" name="zipCode" required>
                                    <div class="invalid-feedback">Please enter ZIP code.</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="country" class="form-label">Country</label>
                                    <input type="text" class="form-control" id="country" name="country" required>
                                    <div class="invalid-feedback">Please enter country.</div>
                                </div>
                            </div>
                        </div>

                        <!-- Medical Information -->
                        <div class="mb-4">
                            <h5 class="border-bottom pb-2 mb-3">Medical Information</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="bloodGroup" class="form-label">Blood Group</label>
                                    <select class="form-control" id="bloodGroup" name="bloodGroup" required>
                                        <option value="">Choose...</option>
                                        <option value="A+">A+</option>
                                        <option value="A-">A-</option>
                                        <option value="B+">B+</option>
                                        <option value="B-">B-</option>
                                        <option value="AB+">AB+</option>
                                        <option value="AB-">AB-</option>
                                        <option value="O+">O+</option>
                                        <option value="O-">O-</option>
                                    </select>
                                    <div class="invalid-feedback">Please select blood group.</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="allergies" class="form-label">Allergies (comma-separated)</label>
                                    <input type="text" class="form-control" id="allergies" name="allergies"
                                        placeholder="e.g., Penicillin, Peanuts">
                                </div>
                                <div class="col-12 mb-3">
                                    <label for="chronicConditions" class="form-label">Chronic Conditions
                                        (comma-separated)</label>
                                    <input type="text" class="form-control" id="chronicConditions"
                                        name="chronicConditions" placeholder="e.g., Diabetes, Hypertension">
                                </div>
                            </div>
                        </div>


                        <!-- Profile Picture -->
                        <div class="mb-4">
                            <h5 class="border-bottom pb-2 mb-3">Profile Picture</h5>
                            <div class="row">
                                <div class="col-12 mb-3">
                                    <label for="profilePicture" class="form-label">Upload Picture</label>
                                    <input type="file" class="form-control" id="profilePicture" name="profilePicture"
                                        accept="image/*">
                                    <div class="form-text">Upload patient's picture (max 5MB)</div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="bloodGroup" class="form-label">Facility</label>
                                    <select name="facilityId" id="departement" class="custom-select" required>
                                        <% if (hospitals && hospitals.length> 0) { %>
                                            <option disabled selected>Select Facility</option>
                                            <% hospitals.forEach(hospital=> { %>
                                                <option value="<%= hospital._id %>">
                                                    <%= hospital.name %>
                                                </option>
                                                <% }) %>
                                                    <% } else { %>
                                                        <option disabled selected>No Facilities Found</option>
                                                        <% } %>
                                    </select>
                                    <div class="invalid-feedback">Please select facility to register under</div>
                                </div>

                            </div>

                        </div>
                       

                        <!-- Submit Button -->
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary  w-100">Save changes</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Form validation
    (() => {
        'use strict';
        const form = document.getElementById('patientForm');

        form.addEventListener('submit', event => {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }

            form.classList.add('was-validated');
        }, false);

        // Clear custom validity when user types in confirm password
        const dateOfBirth = document.getElementById('dateOfBirth');
        dateOfBirth.addEventListener('change', () => {
            const today = new Date();
            const inputDate = new Date(dateOfBirth.value);

            if (inputDate > today) {
                dateOfBirth.setCustomValidity('Date of birth cannot be in the future');
            } else {
                dateOfBirth.setCustomValidity('');
            }
        });
    })();
</script>