<!-- views/patients/register.ejs -->
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10 col-xl-8">
            <div class="card shadow-lg border-0 rounded-3">
                <div class="card-header bg-primary text-white text-center py-4">
                    <h2 class="mb-0">Care Cycle</h2>
                    <p class="lead mb-0">Patient Registration</p>
                </div>
                <div class="card-body p-4">
                    <form id="patientForm" class="needs-validation" novalidate action="/patients/register" method="post"
                        enctype="multipart/form-data">
                        <!-- Basic Information -->
                        <div class="mb-4">
                            <h5 class="border-bottom pb-2 mb-3">Basic Information</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="firstName" class="form-label">First Name</label>
                                    <input type="text" class="form-control" id="firstName" name="firstName" required>
                                    <div class="invalid-feedback">Please enter first name.</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="lastName" class="form-label">Last Name</label>
                                    <input type="text" class="form-control" id="lastName" name="lastName" required>
                                    <div class="invalid-feedback">Please enter last name.</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="dateOfBirth" class="form-label">Date of Birth</label>
                                    <input type="date" class="form-control" id="dateOfBirth" name="dateOfBirth"
                                        required>
                                    <div class="invalid-feedback">Please enter date of birth.</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="gender" class="form-label">Gender</label>
                                    <select class="form-control" id="gender" name="gender" required>
                                        <option value="">Choose...</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                        <option value="other">Other</option>
                                    </select>
                                    <div class="invalid-feedback">Please select gender.</div>
                                </div>
                            </div>
                        </div>

                        <!-- Contact Information -->
                        <div class="mb-4">
                            <h5 class="border-bottom pb-2 mb-3">Contact Information</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="phone" class="form-label">Phone Number</label>
                                    <input type="tel" class="form-control" id="phone" name="phone" required>
                                    <div class="invalid-feedback">Please enter phone number.</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="email" class="form-label">Email (Optional)</label>
                                    <input type="email" class="form-control" id="email" name="email">
                                </div>
                            </div>
                        </div>

                        <!-- Emergency Contact -->
                        <div class="mb-4">
                            <h5 class="border-bottom pb-2 mb-3">Emergency Contact</h5>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="emergencyContactName" class="form-label">Contact Name</label>
                                    <input type="text" class="form-control" id="emergencyContactName"
                                        name="emergencyContactName" required>
                                    <div class="invalid-feedback">Please enter emergency contact name.</div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="emergencyContactRelationship" class="form-label">Relationship</label>
                                    <input type="text" class="form-control" id="emergencyContactRelationship"
                                        name="emergencyContactRelationship" required>
                                    <div class="invalid-feedback">Please specify relationship.</div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="emergencyContactPhone" class="form-label">Contact Phone</label>
                                    <input type="tel" class="form-control" id="emergencyContactPhone"
                                        name="emergencyContactPhone" required>
                                    <div class="invalid-feedback">Please enter emergency contact phone.</div>
                                </div>
                            </div>
                        </div>

                        <!-- Address -->
                        <div class="mb-4">
                            <h5 class="border-bottom pb-2 mb-3">Address</h5>
                            <div class="row">
                                <div class="col-12 mb-3">
                                    <label for="street" class="form-label">Street Address</label>
                                    <input type="text" class="form-control" id="street" name="street" required>
                                    <div class="invalid-feedback">Please enter street address.</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="city" class="form-label">City</label>
                                    <input type="text" class="form-control" id="city" name="city" required>
                                    <div class="invalid-feedback">Please enter city.</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="state" class="form-label">State</label>
                                    <input type="text" class="form-control" id="state" name="state" required>
                                    <div class="invalid-feedback">Please enter state.</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="zipCode" class="form-label">ZIP Code</label>
                                    <input type="text" class="form-control" id="zipCode" name="zipCode" required>
                                    <div class="invalid-feedback">Please enter ZIP code.</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="country" class="form-label">Country</label>
                                    <input type="text" class="form-control" id="country" name="country" required>
                                    <div class="invalid-feedback">Please enter country.</div>
                                </div>
                            </div>
                        </div>

                        <!-- Medical Information -->
                        <div class="mb-4">
                            <h5 class="border-bottom pb-2 mb-3">Medical Information</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="bloodGroup" class="form-label">Blood Group</label>
                                    <select class="form-control" id="bloodGroup" name="bloodGroup" required>
                                        <option value="">Choose...</option>
                                        <option value="A+">A+</option>
                                        <option value="A-">A-</option>
                                        <option value="B+">B+</option>
                                        <option value="B-">B-</option>
                                        <option value="AB+">AB+</option>
                                        <option value="AB-">AB-</option>
                                        <option value="O+">O+</option>
                                        <option value="O-">O-</option>
                                    </select>
                                    <div class="invalid-feedback">Please select blood group.</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="allergies" class="form-label">Allergies (comma-separated)</label>
                                    <input type="text" class="form-control" id="allergies" name="allergies"
                                        placeholder="e.g., Penicillin, Peanuts">
                                </div>
                                <div class="col-12 mb-3">
                                    <label for="chronicConditions" class="form-label">Chronic Conditions
                                        (comma-separated)</label>
                                    <input type="text" class="form-control" id="chronicConditions"
                                        name="chronicConditions" placeholder="e.g., Diabetes, Hypertension">
                                </div>
                            </div>
                        </div>


                        <!-- Profile Picture -->
                        <div class="mb-4">
                            <h5 class="border-bottom pb-2 mb-3">Profile Picture</h5>
                            <div class="row">
                                <div class="col-12 mb-3">
                                    <label for="profilePicture" class="form-label">Upload Picture</label>
                                    <input type="file" class="form-control" id="profilePicture" name="profilePicture"
                                        accept="image/*">
                                    <div class="form-text">Upload patient's picture (max 5MB)</div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="bloodGroup" class="form-label">Facility</label>
                                    <select name="facilityId" id="departement" class="custom-select" required>
                                        <% if (hospitals && hospitals.length> 0) { %>
                                            <option disabled selected>Select Facility</option>
                                            <% hospitals.forEach(hospital=> { %>
                                                <option value="<%= hospital._id %>">
                                                    <%= hospital.name %>
                                                </option>
                                                <% }) %>
                                                    <% } else { %>
                                                        <option disabled selected>No Facilities Found</option>
                                                        <% } %>
                                    </select>
                                    <div class="invalid-feedback">Please select facility to register under</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="password" class="form-label">Password</label>
                                    <input type="password" class="form-control" id="password" name="password"
                                        placeholder="password">
                                </div>
                            </div>

                        </div>
                        <!-- Terms and Conditions -->
                        <div class="mb-4">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="termsCheck" required>
                                <label class="form-check-label" for="termsCheck">
                                    I agree to the terms and conditions
                                </label>
                                <div class="invalid-feedback">
                                    You must agree before submitting.
                                </div>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary  w-100">Register</button>
                        </div>
                        <div class="col justify-content-center align-items-center p-3 mt-4">
                            <p>Already have an account <a href="/login" class="text-decoration-none">Login?</a></p>

                            <p>Healthcare Providers Wanted: <a href="/register/hospital">Join Our Hospital Network</a>

                            <p>Pharmacists, Get Connected: <a href="/register/pharmacy">Register Your Pharmacy Today</a>

                            </p>

                            </p>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Form validation
    (() => {
        'use strict';
        const form = document.getElementById('patientForm');

        form.addEventListener('submit', event => {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        }, false);

        // Optional: Add client-side date validation
        const dateOfBirth = document.getElementById('dateOfBirth');
        dateOfBirth.addEventListener('change', () => {
            const today = new Date();
            const inputDate = new Date(dateOfBirth.value);

            if (inputDate > today) {
                dateOfBirth.setCustomValidity('Date of birth cannot be in the future');
            } else {
                dateOfBirth.setCustomValidity('');
            }
        });
    })();
</script>